<link rel="import" href="../../styles/app-theme.html">
<link rel="import" href="../../styles/shared-styles.html">

<link rel="import" href="../../styles/card-panel-styles.html"> <!--REMOVE-->

<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-icons/places-icons.html">

<link rel="import" href="../../bower_components/iron-meta/iron-meta.html">

<link rel="import" href="time-pong-card-main-panel/time-pong-card-main-panel.html">
<link rel="import" href="time-pong-card-rule-panel/time-pong-card-rule-panel.html">


<dom-module id="time-pong-card-face-two">
  <template>
    <style include="card-panel-styles">
      :host .wrapper {
        box-sizing: border-box;
        position: relative;
        height: 28.75em;
        width: 18.75em;
        background-color: var(--common-soft-tint);
        border: .2em solid var(--common-highlight);
        padding: .2em;
        border-radius: .7em;
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        -ms-flex-direction: column;
        flex-direction: column;
      }
      :host .wrapper.limited {
        background-color: var(--limited-soft-tint);
        border-color: var(--limited-highlight);
      }
      :host .wrapper.special {
        background-color: var(--special-soft-tint);
        border-color: var(--special-highlight);
      }
      :host .wrapper.rare {
        background-color: var(--rare-soft-tint);
        border-color: var(--rare-highlight);
      }

      :host .expired-text {
      @apply(--absolute-template);
        height: inherit;
        display: none;
        font-size: 4.5em;
        color: var(--special-highlight);
        bottom: 2rem;
        left: 0;
        text-align: center;
        font-weight: bold;
        text-shadow: 0 1px 1px var(--secondary-text-color);
      }

      :host.expired .expired-text{
        display: block;
      }
    </style>

    <iron-meta id="appPropsMeta"></iron-meta>

    <div class$="wrapper {{data.rarity}}">
      <time-pong-card-main-panel
          data="{{data}}"
          expired="{{expired}}">
      </time-pong-card-main-panel>

      <time-pong-card-rule-panel
        hidden="{{hideElement(data.primaryRule)}}"
        data="{{data.primaryRule}}"
        rarity="{{data.rarity}}"
        expired="{{expired}}">
      </time-pong-card-rule-panel>

      <time-pong-card-rule-panel
        hidden="{{hideElement(data.secondaryRule)}}"
        data="{{data.secondaryRule}}"
        rarity="{{data.rarity}}"
        expired="{{expired}}">
      </time-pong-card-rule-panel>

      <div class="expired-text">
        Expired
      </div>

    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'time-pong-card-face-two',

        properties: {
          data: {
            type: Object,
            notify: true,
            observer: '_dataChange'
          },
          expired: String
        },

        _dataChange: function(newVal) {
          this.toggleClass('showDuration', false, this.$.duration);
          if (newVal && newVal.duration) {
            this.toggleClass('showDuration', true, this.$.duration);
          }
        },


        hideElement: function(property) {
          var appProps = this.$.appPropsMeta.byKey('appProps');
          if (!property ||
              appProps.drinkingStatus === 'drinking' && property.hideFromDrinkers ||
              appProps.drinkingStatus === 'nonDrinking' && property.hideFromNonDrinkers) {
            return true;
          }
        },

        expire: function() {
          this.toggleClass('expired', true);
          this.expired = 'expired';
        },

        reset: function() {
          this.toggleClass('expired', false);
          this.expired = '';
        }
      });
    })();
  </script>
</dom-module>
