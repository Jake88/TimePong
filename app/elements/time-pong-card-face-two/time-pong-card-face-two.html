<link rel="import" href="../../styles/app-theme.html">
<link rel="import" href="../../styles/shared-styles.html">

<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-meta/iron-meta.html">


<dom-module id="time-pong-card-face-two">
  <template>
    <style>
      :host .wrapper {
        box-sizing: border-box;
        position: relative;
        height: 28.75em;
        width: 18.75em;
        background-color: var(--orange-soft);
        border: .2em solid var(--orange-soft);
        border-radius: .7em;
        display: flex;
        flex-direction: row;
      }
      :host .wrapper.limited {
        background-color: var(--green-soft);
        border-color: var(--green-soft);
      }
      :host .wrapper.special {
        background-color: var(--red-soft);
        border-color: var(--red-soft);
      }
      :host .wrapper.rare {
        background-color: var(--blue-soft);
        border-color: var(--blue-soft);
      }


      :host .left-bar {
        width: 5em;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--secondary-text-color);
      }

      :host.expired .left-bar {
        color: var(--light-grey);
      }

      :host h4 {
        text-transform: uppercase;
        font-size: .6em;
        margin: 0;
        font-weight: 100;
      }

      :host .left-bar div {
        text-align: center;
        padding: 1em 0;
      }

      :host .left-bar .type-display iron-icon {
        --iron-icon-height: 2.5em;
        --iron-icon-width: 2.5em;
        opacity: .5;
      }

      :host .left-bar .title-display {
        flex: 1 1 100%;
        box-shadow: inset 0 0 1em rgba(0,0,0,.1);
        /*box-shadow: inset 2px 2px 3px var(--drop-shadow-color);*/
        /*background-color: var(--orange-soft-tint);*/
        border-radius: 0em 1em 0em 1em;
        display: flex;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        width: 2em;
        white-space: nowrap;
        font-size: 1em;
      }
      :host .left-bar .title-display h4 {
        font-size: .8em;
      }
      :host .wrapper.limited .left-bar .title-display {
        box-shadow: inset 0 0 1em var(--green-highlight);
      }
      :host .wrapper.special .left-bar .title-display {
        box-shadow: inset 0 0 1em var(--red-highlight);
      }
      :host .wrapper.rare .left-bar .title-display {
        box-shadow: inset 0 0 1em var(--blue-highlight);
      }

      :host .left-bar .title-display .side-text {
        transform: rotateZ(-90deg);
      }

      :host .left-bar .duration-display {
        visibility: hidden;
        position: relative;
      }

      :host .left-bar .duration-display.showDuration {
        visibility: visible;
      }

      :host .left-bar .duration-display iron-icon {
        --iron-icon-height: 2.5em;
        --iron-icon-width: 2.5em;
        opacity: .5;
      }

      :host .left-bar .duration-display p {
        position: absolute;
        bottom: 1.9em;
        left: 1.1em;
        margin: 0;
        font-weight: 100;
        font-size: .9em;
      }

      :host .main-container {
        flex: 1 1 100%;
        display: flex;
        flex-direction: column;
      }

      :host.expired .main-container {
        color: var(--light-grey);
      }

      :host .main-container iron-icon.background-icon {
        position: absolute;
        bottom: -1.9em;
        right: -1.9em;
        --iron-icon-height: 14em;
        --iron-icon-width: 14em;
        color: var(--orange-soft);
        opacity: .7;
      }
      :host .wrapper.limited .main-container iron-icon.background-icon {
        color: var(--green-soft);
      }
      :host .wrapper.special .main-container iron-icon.background-icon {
        color: var(--red-soft);
      }
      :host .wrapper.rare .main-container iron-icon.background-icon {
        color: var(--blue-soft);
      }

      :host .main-container .content {
        border-radius: .7em;
        border: 1px solid var(--orange-soft-tint);
        background-color: var(--primary-background-color);
        padding: 1em;
        position: relative;
        flex: 1 1 100%;
      }

      :host .main-container h2 {
        font-weight: 100;
        margin-bottom: 1em;
        margin-top: 0;
      }

      :host .main-container p {
        font-weight: 100;
        margin-bottom: 1em;
      }

      :host .drinks-container {
        display: flex;
        flex-direction: row;
        box-sizing: border-box;
        position: relative;
        border-radius: .7em;
        color: var(--secondary-text-color);
        background-color: var(--orange-soft-tint);
        border: 1px solid var(--orange-soft-tint);
        margin-top: .2em;
        text-align: center;
        height: 3em;
        overflow: hidden;
        -webkit-mask-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC); /* this fixes the overflow:hidden in Chrome/Opera */
      }
      :host .drinks-container div {
        flex: 1 1 25%;
        /*box-shadow: inset 0 0 5em rgba(0,0,0,.1);*/
        /*box-shadow: inset 0 0 3em rgba(255,255,255,1);*/
      }
      :host .drinks-container iron-icon {
        --iron-icon-height: 2.5em;
        --iron-icon-width: 2.5em;
        color: var(--secondary-text-color);
      }
      :host .drinks-container h4 {
        position: relative;
        margin-top: -.9em;
        font-weight: bold;
        font-size: .7em;
        padding-top: .2em;
        background-color: var(--primary-background-color);
        border-top: 1px solid var(--secondary-text-color);
      }

      :host .drinks-container .drink-rule-description {
        background-color: var(--primary-background-color);
        font-size: .7em;
        margin: 0;
        flex: 1 1 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: .2em;
        font-weight: normal;
        color: var(--primary-text-color);
        border-radius: 50% 50% 0 0;
        position: relative;
      }

      :host .drinks-container .drink-rule-description .drink-rule-condition {
        text-align: center;
        text-transform: uppercase;
        flex: 0 1 100%;
      }
      :host .drinks-container .drink-rule-description .drink-rule-condition.success {
        color: var(--green-highlight);
      }
      :host .drinks-container .drink-rule-description .drink-rule-condition.fail {
        color: var(--red-highlight);
      }

      :host .or-text {
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        line-height: 1rem;
        padding-top: 2px;
        width: 1.5rem;
        height: 1.5rem;
        background-color: var(--orange-soft);
        border-radius: 50%;
        border: 1px solid var(--orange-soft-tint);
        position: absolute;
        bottom: 2.4rem;
        right: 10rem;
        font-size:.7em;
        text-transform: uppercase;
        box-shadow: 0 1px 1px var(--secondary-text-color);
      }

      :host .expired-text {
      @apply(--absolute-template);
        height: inherit;
        display: none;
        font-size: 4.5em;
        color: var(--red-highlight);
        bottom: 2rem;
        left: 0;
        text-align: center;
        font-weight: bold;
        text-shadow: 0 1px 1px var(--secondary-text-color);
      }

      :host.expired .expired-text{
        display: block;
      }
    </style>

    <iron-meta id="appPropsMeta"></iron-meta>

    <div class$="wrapper {{data.rarity}}">

      <div class="left-bar">

        <div class="type-display">
          <h4>
            {{data.rarity}}<br/>
            {{data.type}}
          </h4>
          <iron-icon icon="star"></iron-icon>
        </div>

        <div class="title-display">
          <h4 class="side-text">{{data.title}}</h4>
        </div>

        <div id="duration" class="duration-display">
          <h4>Rounds</h4>
          <iron-icon icon="cached"></iron-icon>
          <p>{{data.duration}}</p>
        </div>
      </div>


      <div class="main-container">
        <iron-icon class="background-icon" icon="maps:local-bar"></iron-icon>

        <div class="content">
          <h2>{{data.title}}</h2>
          <template is="dom-repeat" items="{{data.rules}}">
            <p>{{item}}</p>
          </template>
        </div>

        <div class="drinks-container" hidden="{{hideElement(data.primaryDrinkRule)}}">
          <div class="drink-rule-person">
            <iron-icon icon="social:person"></iron-icon>
            <h4>{{data.primaryDrinkRule.person}}</h4>
          </div>
          <p class="drink-rule-description">
            <span class$="drink-rule-condition {{data.primaryDrinkRule.condition}}">{{data.primaryDrinkRule.condition}}</span>
            <span>{{data.primaryDrinkRule.description}}</span>
          </p>
          <div class="drink-rule-drinks">
            <iron-icon icon="maps:local-drink"></iron-icon>
            <h4>{{data.primaryDrinkRule.value}}</h4>
          </div>
        </div>

        <div class="drinks-container" hidden="{{hideElement(data.secondaryDrinkRule)}}">
          <div class="drink-rule-person">
            <iron-icon icon="social:person"></iron-icon>
            <h4>{{data.secondaryDrinkRule.person}}</h4>
          </div>
          <p class="drink-rule-description">
            <span class$="drink-rule-condition {{data.secondaryDrinkRule.condition}}">{{data.secondaryDrinkRule.condition}}</span>
            <span>{{data.secondaryDrinkRule.description}}</span>
          </p>
          <div class="drink-rule-drinks">
            <iron-icon icon="face"></iron-icon>
            <h4>{{data.secondaryDrinkRule.value}}</h4>
          </div>
        </div>

        <span class="or-text">or</span>

        <div class="expired-text">
          Expired
        </div>
      </div>



    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'time-pong-card-face-two',

        properties: {
          data: {
            type: Object,
            notify: true,
            observer: '_dataChange'
          }
        },

        _dataChange: function(newVal) {
          this.toggleClass('showDuration', false, this.$.duration);
          if (newVal && newVal.duration) {
            this.toggleClass('showDuration', true, this.$.duration);
          }

          function updateStyle() {
            this.updateStyles();
          }
          setTimeout(updateStyle.bind(this), 10); // Hack to ensure styles are updated after the data changes.
        },

        getDrinkLabel: function(drinksValue) {
          return ['1', 'S'].indexOf(drinksValue) > -1 ? 'Drink' : 'Drinks';
        },

        hideElement: function(property) {
          var appProps = this.$.appPropsMeta.byKey('appProps');
          if (_.isUndefined(property) || appProps.isNonDrinking) {
            return true;
          }
        },

        expire: function() {
          this.toggleClass('expired', true);
        },

        reset: function() {
          this.toggleClass('expired', false);
        }
      });
    })();
  </script>
</dom-module>
