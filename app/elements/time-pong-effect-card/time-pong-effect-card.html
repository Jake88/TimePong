<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<link rel="import" href="../time-pong-card-face-two/time-pong-card-face-two.html">

<dom-module id="time-pong-effect-card">
  <template>
    <style include="shared-styles">
      :host .effect-wrapper {
        z-index: 1;
        border: 1px solid #ccc;
        border-radius: 3px;
        height: 5.75em;
        width: 3.75em;
        margin-top: 1em;
      }

      :host time-pong-card-face-two {
      @apply(--card-wrapper);
        border-radius: 10px;
        display: none;
        z-index: 4;
        -webkit-transition: opacity .4s;
        transition: .4s;
      }

      :host.open time-pong-card-face-two {
        display: block;
      }
      :host.fade time-pong-card-face-two {
        display: block;
        opacity: 0;
        -webkit-transition: .4s;
        transition: .4s;
      }

      :host h4 {
        position: relative;
        width: 100%;
        color: var(--light-grey);
        font-weight: 100;
        margin: -17px 0 2px 0;
      }
      :host.active h4 {
        color: var(--overlay-background-color);
      }

      :host .dark-overlay {
        opacity: 0;
        -webkit-transition: opacity .5s linear;
        transition: opacity .5s linear;
        position: absolute;
        top: -2000px;
        left: -2000px;
        width: 5000px;
        height: 5000px;
        background-color: #333;
        z-index: -1;
      }
      :host.animating .dark-overlay {
        z-index: 3;
      }
      :host.overlay .dark-overlay {
        z-index: 3;
        opacity: .7;
        -webkit-transition: opacity .5s linear;
        transition: opacity .5s linear;
      }
    </style>

    <div class="dark-overlay"></div>

    <time-pong-card-face-two
      on-tap="toggleCard"
      class$="{{data.rarity}}"
      data="{{data}}"
      is-effect="true">
    </time-pong-card-face-two>

    <div class="effect-wrapper" on-tap="toggleCard">
      <h4>{{label}}</h4>
      <iron-icon icon="block"></iron-icon>
      <h4>{{data.title}}</h4>
    </div>



  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'time-pong-effect-card',

        properties: {
          data: {
            type: Object,
            notify: true,
            observer: '_dataChanged'
          },
          label: String,
          index: Number
        },

        _dataChanged: function(newVal) {
          this.toggleClass('active', (newVal && newVal.title));
        },

        roundEnd: function() {
          if (this.data && this.data.duration) {
            this.set('data.duration', this.data.duration -= 1);
            if (this.data.duration === 0) {
              setTimeout(this.expire.bind(this), 500);
            }
          }
        },

        expire: function() {
          this.toggleCard();
          this.$$('time-pong-card-face-two').expire();
        },

        toggleCard: function() {
          if (this.className.indexOf('animating') === -1) {
            if (this.data.duration === 0 && this.className.indexOf('open') > -1) {
              this.fade();
            } else {
              this.toggleClass('open');
            }
            this.toggleClass('overlay');
            this.toggleClass('animating');
            setTimeout(this.stopAnimating.bind(this), 500);
          }
        },

        stopAnimating: function() {
          this.toggleClass('animating', false);
        },

        fade: function() {
          this.toggleClass('fade', true);
          setTimeout(this.clearEffect.bind(this), 300)
        },

        clearEffect: function() {
          this.data = null;
          this.toggleClass('open', false);
          this.toggleClass('fade', false);
          this.$$('time-pong-card-face-two').reset();
        }
      });
    })();
  </script>
</dom-module>
