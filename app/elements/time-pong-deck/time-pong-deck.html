<!-- Add your elements here -->
<link rel="import" href="../../styles/app-theme.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../time-pong-card-face-two/time-pong-card-face-two.html">
<link rel="import" href="../time-pong-card-back-one/time-pong-card-back-one.html">

<dom-module id="time-pong-deck">
  <template>
    <style>
      /* entire container, keeps perspective */
      :host .flip-container {
      @apply(--card-wrapper);
        -webkit-perspective: 1000px;
        perspective: 1000px;
        -webkit-transform: rotateZ(-1deg) translate3d(0, var(--top-pos-closed), 0);
        transform: rotateZ(-1deg) translate3d(0, var(--top-pos-closed), 0);
        -webkit-transition: -webkit-transform .9s linear;
        transition: transform .9s linear;
        z-index: 2;
      }

      :host.open .flip-container {
        -webkit-transform: rotateZ(0deg) translate3d(0, 0, 0);
        transform: rotateZ(0deg) translate3d(0, 0, 0);
        z-index: 4;
      }

      :host .flip-container .card-main {
      @apply(--absolute-template);
        left: 0;
        bottom: 0;
        border-radius: 10px;
        border: 1px solid var(--primary-text-color);
        box-shadow: 0 0 3px var(--primary-text-color);
      }

      :host.open .flip-container .card-main {
        box-shadow: 0 0 13px var(--primary-text-color);
      }

      :host.open.flipped .flip-container .flipper {
        -webkit-transform: rotateY(180deg);
        transform: rotateY(180deg);
      }

      .flipper {
        -webkit-transition: .8s linear;
        transition: .8s linear;
        -webkit-transform-style: preserve-3d;
        transform-style: preserve-3d;
        position: relative;
      }

      /* hide back of pane during swap */
      .face, .back {
      @apply(--absolute-template);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        top: 0;
        left: 0;
      }

      /* face pane, placed above back */
      .back {
        z-index: 100;
        -webkit-transform: translate3d(0, 0, 0) rotateY(0deg);
        transform: translate3d(0, 0, 0) rotateY(0deg);
      }

      /* back, initially hidden pane */
      .face {
        -webkit-transform: translate3d(0, 0, 0) rotateY(180deg);
        transform: translate3d(0, 0, 0) rotateY(180deg);
      }

      :host .card-stack {
        position: absolute;
        height: 4em;
        width: 18.75em;
        left: 50%;
        margin-left: -9.375em;
        bottom: 0;
        border-radius: 10px 10px 0 0;
        border: 1px solid var(--primary-text-color);
        border-bottom: 0;
        box-shadow: 0 0 2px var(--primary-text-color);
        -webkit-animation: soft-color-loop 10s infinite;
        animation: soft-color-loop 10s infinite;
      }

      :host .card-stack.card-1 {
        -webkit-transform: rotateZ(-2deg) translate(0, 3px);
        transform: rotateZ(-2deg) translate(0, 3px);
      }

      :host .card-stack.card-2 {
        margin-bottom: -4px;
        -webkit-transform: rotateZ(1deg) translate(0, 5px);
        transform: rotateZ(1deg) translate(0, 5px);
      }

      :host .card-stack.card-3 {
        margin-bottom: -7px;
        -webkit-transform: rotateZ(-1deg) translate(0, 8px);
        transform: rotateZ(-1deg) translate(0, 8px);
      }

      :host .card-stack.card-4 {
        margin-bottom: -11px;
        -webkit-transform: rotateZ(-2deg) translate(0, 10px);
        transform: rotateZ(-2deg) translate(0, 10px);
      }

      :host .dark-overlay {
        opacity: 0;
        filter: alpha(opacity=0);
        -webkit-transition: opacity .5s linear, z-index 1s linear;
        transition: opacity .5s linear, z-index 1s linear;
        position: absolute;
        top: -2000px;
        left: -2000px;
        width: 5000px;
        height: 5000px;
        background-color: #333;
        z-index: -1;
      }

      :host.open .dark-overlay {
        opacity: .5;
        filter: alpha(opacity=50);
        z-index: 4;
        -webkit-transition: opacity .5s linear;
        transition: opacity .5s linear;
      }
    </style>

    <div class="dark-overlay"></div>

    <div class="card-stack card-1"></div>
    <div class="card-stack card-2"></div>
    <div class="card-stack card-3"></div>
    <div class="card-stack card-4"></div>

    <div id="flipContainer" class="flip-container">
      <div class="card-main flipper">
        <time-pong-card-back-one
          id="cardBack"
          class="back"
          selected-category="{{cardCategory}}">
        </time-pong-card-back-one>

        <time-pong-card-face-two
          on-tap="closeCard"
          id="currentCard"
          class$="face {{currentCard.rarity}}"
          data="{{currentCard}}">
        </time-pong-card-face-two>
      </div>
    </div>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'time-pong-deck',

        properties: {
          currentCard: { // Required to pass into face card
            type: Object,
            notify: true,
            observer: '_cardChanged'
          }
        },

        ready: function() {
          this.customStyle['--top-pos-closed'] = 100 + '%';
          this.updateStyles();
        },

        reRender: function() {
          var h = document.querySelector('page-time-pong .content').offsetHeight;

          console.log(h);
          this.customStyle['--top-pos-closed'] = h - 60 + 'px';
          this.updateStyles(); // mandatory for the CSS variables shim
        },

        _cardChanged: function() {
          this.toggleClass('flipped', true);
        },

        closeCard: function() {
          this.toggleClass('open', false);
          this.toggleClass('flipped', false);
          this.fire('round-end');
        },

        drawCard: function() {
          this.toggleClass('open', true);
        }
      });

    })();
  </script>
</dom-module>

