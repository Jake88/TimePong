<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="time-pong-deck">
  <template>
    <style>
      :host {
        --card-highlight-color: var(--yellow-highlight);
        --card-soft-color: var(--yellow-soft);
      }
      :host .uncommon {
        --card-highlight-color: var(--green-highlight);
        --card-soft-color: var(--green-soft);
      }
      :host .rare {
        --card-highlight-color: var(--red-highlight);
        --card-soft-color: var(--red-soft);
      }
      :host .bluemoon {
        --card-highlight-color: var(--blue-highlight);
        --card-soft-color: var(--blue-soft);
      }

      /* entire container, keeps perspective */
      :host .flip-container {
        @apply(--card-wrapper);
        top: var(--top-pos-closed);
        margin-top: -85px;
        border-radius: 10px;
        perspective: 1000px;
        transform: rotateZ(-1deg) translate3d(0, 0, 0);
        transition: transform .9s linear;
        z-index: 2;
      }

      :host.open .flip-container {
        transform: rotateZ(0deg) translate3d(0, var(--top-pos-opened), 0);
        z-index: 4;
      }

      :host .flip-container .card-main {
        @apply(--absolute-template);
        left: 0;
        bottom: 0;
        border-radius: 10px;
        border: 1px solid var(--primary-text-color);
        box-shadow: 0 0 3px var(--primary-text-color);
      }

      :host.open .flip-container .card-main {
        box-shadow: 0 0 13px var(--primary-text-color);
      }

      :host.open.flipped .flip-container .flipper {
        transform: rotateY(180deg);
      }

      .flipper {
        transition: .8s linear;
        -webkit-transform-style: preserve-3d;
        transform-style: preserve-3d;
        position: relative;
      }

      /* hide back of pane during swap */
      .face, .back {
        @apply(--absolute-template);
        backface-visibility: hidden;
        top: 0;
        left: 0;
      }

      /* face pane, placed above back */
      .back {
        z-index: 100;
        transform: translate3d(0, 0, 0) rotateY(0deg);
      }

      /* back, initially hidden pane */
      .face {
        transform: translate3d(0, 0, 0) rotateY(180deg);
      }

      :host .card-stack {
        height: 85px;
        width: calc(100% - 60px);
        left: 30px;
        bottom: 0;
        border-radius: 10px 10px 0 0;
        border: 1px solid var(--primary-text-color);
        border-bottom: 0;
        position: absolute;
        box-shadow: 0 0 2px var(--primary-text-color);
        animation: soft-color-loop 10s infinite;
        -moz-animation: soft-color-loop 10s infinite; /* Firefox */
        -webkit-animation: soft-color-loop 10s infinite; /* Safari and Chrome */
      }

      :host .card-stack.card-1 {
        transform: rotateZ(-2deg) translate(0, 3px);
      }

      :host .card-stack.card-2 {
        margin-bottom: -4px;
        transform: rotateZ(1deg) translate(0, 5px);
      }

      :host .card-stack.card-3 {
        margin-bottom: -7px;
        transform: rotateZ(-1deg) translate(0, 8px);
      }

      :host .card-stack.card-4 {
        margin-bottom: -11px;
        transform: rotateZ(-2deg) translate(0, 10px);
      }

      :host .change-cat-button {
        @apply(--absolute-template);
        bottom: 20px;
        left: 0;
        height: initial;
        justify-content: center;
        display: flex;
        align-items: center;
        color: var(--link-color);
      }

      :host .change-cat-button span {
        border-bottom: 1px solid var(--link-color);
      }

      :host .dark-overlay {
        opacity: 0;
        transition: opacity .5s linear, z-index 1s linear;
        position: absolute;
        top: -2000px;
        left: -2000px;
        width: 5000px;
        height: 5000px;
        background-color: #333;
        z-index: -1;
      }

      :host.open .dark-overlay {
        opacity: .5;
        z-index: 4;
        transition: opacity .5s linear;
      }
    </style>

    <div class="dark-overlay"></div>

    <div class="card-stack card-1"></div>
    <div class="card-stack card-2"></div>
    <div class="card-stack card-3"></div>
    <div class="card-stack card-4"></div>

    <div id="flipContainer" class="flip-container">
      <div class="card-main flipper">
        <time-pong-card-back-one
          id="cardBack"
          class="back"
          selected-category="{{cardCategory}}">
        </time-pong-card-back-one>

        <time-pong-card-face-one
          on-tap="closeCard"
          id="currentCard"
          class$="face {{currentCard.rarity}}"
          data="{{currentCard}}">
        </time-pong-card-face-one>
      </div>
    </div>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'time-pong-deck',

        properties: {
          currentCard: { // Required to pass into face card
            type: Object,
            notify: true,
            observer: '_cardChanged'
          }
        },

        attached: function() {
          // Generate a variable to hold the card height in px.
          this.customStyle['--top-pos-closed'] = this.$.flipContainer.offsetHeight + 'px';
          this.customStyle['--top-pos-opened'] = -this.$.flipContainer.offsetHeight + 45 + 'px';
          this.updateStyles(); // mandatory for the CSS variables shim
        },

        _cardChanged: function() {
          this.toggleClass('flipped', true);
        },

        closeCard: function() {
          this.toggleClass('open', false);
          this.toggleClass('flipped', false);
          this.fire('round-end');
        },

        drawCard: function() {
          this.toggleClass('open', true);
        }
      });

    })();
  </script>
</dom-module>

